{% extends "layout.html" %}

{% block title %}Aqua Track: Water Quality Monitoring System - WQI Calculator{% endblock %}

{% block content %}
        <!-- What is WQI? -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h4 mb-2">What is WQI?</h2>
                        <p class="mb-1">
                            Water Quality Index (WQI) is a single score that quickly tells you how safe the water is.
                        </p>
                        <p class="mb-1">
                            It combines temperature, pH, turbidity and other water parameters into one easy-to-read number.
                        </p>
                        <p class="mb-0">
                            Lower scores mean cleaner, safer water. Higher scores mean the water may need more treatment.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <!-- Input Card -->
            <div class="col-12 col-md-5">
                <div class="card shadow">
                    <div class="card-header bg-white">
                        <h4>Enter Water Parameters</h4>
                    </div>
                    <div class="card-body">
                        <form id="wqiForm">
                            <div class="mb-3">
                                <label>pH Level</label>
                                <input type="number" step="0.1" class="form-control" id="ph" required>
                            </div>
                            <div class="mb-3">
                                <label>Dissolved Oxygen (mg/L)</label>
                                <input type="number" step="0.1" class="form-control" id="do" required>
                            </div>
                            <div class="mb-3">
                                <label>Turbidity (NTU)</label>
                                <input type="number" step="0.1" class="form-control" id="turbidity" required>
                            </div>
                            <div class="mb-3">
                                <label>TDS (mg/L)</label>
                                <input type="number" step="1" class="form-control" id="tds" required>
                            </div>
                            <div class="mb-3">
                                <label>Nitrate (mg/L)</label>
                                <input type="number" step="0.1" class="form-control" id="nitrate" required>
                            </div>
                            <div class="mb-3">
                                <label>Temperature (Â°C)</label>
                                <input type="number" step="0.1" class="form-control" id="temperature" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Calculate WQI</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Result Card -->
            <div class="col-12 col-md-7 mt-4 mt-md-0">
                <div class="card shadow">
                    <div class="card-header bg-white">
                        <h4>Results</h4>
                    </div>
                    <div class="card-body text-center">
                        <!-- Large WQI Indicator with chart background -->
                        <div class="chart-container mb-3" style="position: relative; height:200px; width:100%; display:flex; justify-content:center;">
                            <canvas id="wqiChart"></canvas>
                            <div id="wqiBadge" class="badge bg-secondary px-4 py-3"
                                 style="position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); font-size: 2.2rem; font-weight: 700;">
                                --
                            </div>
                        </div>

                        <!-- Status and simple safety message -->
                        <div class="mt-2">
                            <h5 class="mb-1">Status: <span id="statusBadge" class="badge bg-secondary">Unknown</span></h5>
                            <p id="safetyMessage" class="mt-2 fs-5 fw-semibold">
                                Enter your water values to see if this water is safe.
                            </p>
                        </div>

                        <!-- Visual WQI scale bar -->
                        <div class="mt-4 text-start">
                            <h5 class="mb-2">WQI Scale</h5>
                            <div class="wqi-scale position-relative mt-1">
                                <div class="wqi-segment wqi-excellent">Excellent</div>
                                <div class="wqi-segment wqi-good">Good</div>
                                <div class="wqi-segment wqi-poor">Poor</div>
                                <div class="wqi-segment wqi-very-poor">Very Poor</div>
                                <div class="wqi-segment wqi-unfit">Unfit</div>
                                <div id="wqiMarker" class="wqi-marker">â–²</div>
                            </div>
                            <div class="d-flex justify-content-between small mt-1">
                                <span>0</span>
                                <span>25</span>
                                <span>50</span>
                                <span>75</span>
                                <span>100+</span>
                            </div>
                        </div>

                        <!-- Icon-based parameter summary -->
                        <div id="parameterSummary" class="mt-4 text-start d-none">
                            <h5 class="mb-3">Your water at a glance</h5>
                            <div class="row g-3">
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸ§ª</div>
                                            <h6 class="mb-1">pH</h6>
                                            <p class="mb-0"><span id="summaryPh">--</span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸ’§</div>
                                            <h6 class="mb-1">Dissolved Oxygen</h6>
                                            <p class="mb-0"><span id="summaryDo">--</span> mg/L</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸŒ«</div>
                                            <h6 class="mb-1">Turbidity</h6>
                                            <p class="mb-0"><span id="summaryTurbidity">--</span> NTU</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸ§‚</div>
                                            <h6 class="mb-1">TDS</h6>
                                            <p class="mb-0"><span id="summaryTds">--</span> mg/L</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸŒ¿</div>
                                            <h6 class="mb-1">Nitrate</h6>
                                            <p class="mb-0"><span id="summaryNitrate">--</span> mg/L</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6 col-lg-4">
                                    <div class="card h-100 border-0 shadow-sm parameter-card">
                                        <div class="card-body">
                                            <div class="fs-3 mb-1">ðŸŒ¡</div>
                                            <h6 class="mb-1">Temperature</h6>
                                            <p class="mb-0"><span id="summaryTemperature">--</span> Â°C</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Why is my WQI like this? -->
                        <div class="mt-4 text-start">
                            <button class="btn btn-outline-secondary w-100 text-start" type="button"
                                    data-bs-toggle="collapse" data-bs-target="#wqiWhyCollapse" aria-expanded="false"
                                    aria-controls="wqiWhyCollapse">
                                Why is my WQI like this?
                            </button>
                            <div class="collapse mt-2" id="wqiWhyCollapse">
                                <div class="card card-body">
                                    <ul class="mb-0" id="wqiWhyList">
                                        <li>Enter your values to see which parameters influence your WQI the most.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Awareness note -->
                        <div class="mt-4">
                            <p class="small text-muted mb-0">
                                This WQI is for awareness purposes and reflects the current data shown.
                                Values may change with time and location.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
